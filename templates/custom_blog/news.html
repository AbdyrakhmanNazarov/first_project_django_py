{% extends 'base.html' %}

{% block blocktitle %}
  {{ title }}
{% endblock %}

{% block content %}
  <div class="content-wrapper">
    <section class="students_container">
      {% if news_list %}
        {% for news in news_list %}
          <div class="student_card">
            {% if news.image %}
              <img src="{{ news.image.url }}" alt="{{ news.title }}" />
            {% else %}
              <div>Нет изображения</div>
            {% endif %}

            <div class="news-content">
              <h2>{{ news.title|default:'Без названия' }}</h2>
              <h3>{{ news.subtitle }}</h3>
              <p>
                <strong>Категория:</strong> {{ news.category.name|default:'Без категории' }}<br />
                <strong>Дата:</strong> {{ news.created_at|date:'d.m.Y H:i' }}
              </p>

              <a href="{% url 'news_detail' news.pk %}">Подробнее →</a>

              {% if user.is_authenticated and user.is_staff %}
                <div>
                  <a href="{% url 'news_update' news.pk %}">Редактировать</a>
                  <a href="{% url 'news_delete' news.pk %}">Удалить</a>
                </div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p>Пока нет новостей.</p>
      {% endif %}

      {% if user.is_authenticated and user.is_staff %}
        <a href="{% url 'news_create' %}">Добавить новость</a>
      {% endif %}
    </section>

    <aside>
      <h3>Фильтр новостей</h3>
      <form method="GET">
        {{ filterset.form.as_p }}
        <button type="submit">Применить фильтр</button>
      </form>
    </aside>
  </div>

  {% if is_paginated %}
    <div class="pagination">
      {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}">Предыдущая</a>
      {% else %}
        <span class="disabled">Предыдущая</span>
      {% endif %}

      {% for i in paginator.page_range %}
        {% if page_obj.number == i %}
          <span class="current">{{ i }}</span>
        {% else %}
          <a href="?page={{ i }}">{{ i }}</a>
        {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">Следующая</a>
      {% else %}
        <span class="disabled">Следующая</span>
      {% endif %}
    </div>
  {% endif %}
{% endblock %}
