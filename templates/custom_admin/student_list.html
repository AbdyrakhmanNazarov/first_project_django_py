{% extends 'base.html' %}
{% load static %}

{% block blocktitle %}–°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤{% endblock %}

{% block content %}
<main>
  <h2>–§—É—Ç–±–æ–ª–∏—Å—Ç—ã</h2>

  <div class="content-wrapper" style="display:flex; gap:20px;">
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç: —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
    <section class="students_container" style="flex-grow:1;">
      <div class="top_panel">
        <div class="actions">
          <a href="{% url 'create_student' %}" class="create-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞</a>
        </div>
      </div>

      {% for student in students %}
        <div class="student_card">
          <a href="{% url 'student_detail' student.pk %}">
            {% if student.avatar %}
              <img src="{{ student.avatar.url }}" alt="{{ student.name }} {{ student.surname }}" class="avatar-img" />
            {% else %}
              <div class="no_avatar">–ù–µ—Ç –∞–≤–∞—Ç–∞—Ä–∞</div>
            {% endif %}
          </a>

          <div class="student_info">
            <div><strong>–ò–º—è:</strong> {{ student.name|default:'‚Äî' }}</div>
            <div><strong>–§–∞–º–∏–ª–∏—è:</strong> {{ student.surname|default:'‚Äî' }}</div>
            <div><strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> {{ student.age|default:'‚Äî' }}</div>
            <div><strong>–ù–æ–º–µ—Ä:</strong> {{ student.number|default:'‚Äî' }}</div>
            <div><strong>–ì—Ä—É–ø–ø–∞:</strong> {% if student.group %}{{ student.group.name }}{% else %}–ë–µ–∑ –≥—Ä—É–ø–ø—ã{% endif %}</div>
            <div><strong>Email:</strong> {{ student.email|default:'‚Äî' }}</div>
            <div><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ student.phone_number|default:'‚Äî' }}</div>

            <div>
              <strong>–ë–∞–ª–∞–Ω—Å:</strong> {{ student.contract.balance|default:'0' }}
              {% if student.contract %}
                <form method="post" action="{% url 'student_payment' student.contract.pk %}">
                  {% csrf_token %}
                  <input type="hidden" name="amount" value="8000">
                  <button type="submit" class="pay-btn">–û–ø–ª–∞—Ç–∏—Ç—å 8000</button>
                </form>
                <a href="{% url 'student_payment_page' student.contract.pk %}" class="create-btn">–û–ø–ª–∞—Ç–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ</a>
              {% endif %}
            </div>

            <div><strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong> {{ student.join_date }}</div>
            <div><strong>–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:</strong> {{ student.updated_date }}</div>

            <div><strong>–¢–µ–≥–∏:</strong>
              {% for tag in student.tags.all %}
                <span class="tag">{{ tag.name }}</span>{% if not forloop.last %}, {% endif %}
              {% empty %}
                –ù–µ—Ç —Ç–µ–≥–æ–≤
              {% endfor %}
            </div>

            <div class="student_actions">
              <a href="{% url 'student_update' student.pk %}" class="edit-btn">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
              <a href="{% url 'student_delete' student.pk %}" class="delete-btn">üóë –£–¥–∞–ª–∏—Ç—å</a>
            </div>
          </div>
        </div>
      {% empty %}
        <p>–ù–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>
      {% endfor %}

      {% if is_paginated %}
        <div class="pagination">
          {% if page_obj.has_previous %}
            <a class="page_link" href="?page={{ page_obj.previous_page_number }}{% if request.GET %}&{{ request.GET.urlencode }}{% endif %}">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
          {% else %}
            <span class="page_link disabled">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</span>
          {% endif %}

          {% for i in paginator.page_range %}
            {% if page_obj.number == i %}
              <span class="page_link current">{{ i }}</span>
            {% else %}
              <a class="page_link" href="?page={{ i }}{% if request.GET %}&{{ request.GET.urlencode }}{% endif %}">{{ i }}</a>
            {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
            <a class="page_link" href="?page={{ page_obj.next_page_number }}{% if request.GET %}&{{ request.GET.urlencode }}{% endif %}">–°–ª–µ–¥—É—é—â–∞—è</a>
          {% else %}
            <span class="page_link disabled">–°–ª–µ–¥—É—é—â–∞—è</span>
          {% endif %}
        </div>
      {% endif %}
    </section>

    <!-- Sidebar —Å–ø—Ä–∞–≤–∞: —Ñ–∏–ª—å—Ç—Ä -->
    <aside class="filter-aside" style="width:250px; flex-shrink:0;">
      <h3>–§–∏–ª—å—Ç—Ä —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h3>
      <form method="GET">
        {{ filter.form.as_div }}
        <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä</button>
      </form>
    </aside>
  </div>
</main>
{% endblock %}
