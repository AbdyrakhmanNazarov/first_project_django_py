{% extends 'base.html' %}
{% load static %}

{% block blocktitle %}
  {{ title }}
{% endblock %}

{% block content %}
  <main>
    <h2>–ò—Å–ø–∞–Ω–∏—è, –ú–∞–¥—Ä–∏–¥</h2>
    <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ñ—É—Ç–±–æ–ª—å–Ω–æ–≥–æ –∫–ª—É–±–∞ –†–µ–∞–ª –ú–∞–¥—Ä–∏–¥!</p>

    <div class="content-wrapper" style="display:flex; gap:20px;">
      <!-- –°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Å–ª–µ–≤–∞ -->
      <section class="students_container" style="flex-grow:1;">
        {% for student in students %}
          <div class="student_card">
            <div class="student_avatar">
              <a href="{% url 'student_detail' student.pk %}">
                {% if student.avatar %}
                  <img src="{{ student.avatar.url }}" alt="{{ student.name }} {{ student.surname }}" />
                {% else %}
                  –ù–µ—Ç –∞–≤–∞—Ç–∞—Ä–∞
                {% endif %}
              </a>
            </div>

            <div>–ò–º—è: {{ student.name|default:'‚Äî' }}</div>
            <div>–§–∞–º–∏–ª–∏—è: {{ student.surname|default:'‚Äî'|upper }}</div>
            <div>–í–æ–∑—Ä–∞—Å—Ç: {{ student.age|default:'‚Äî' }}</div>
            <div>
              –î–æ–ª–∂–Ω–æ—Å—Ç—å:{% if student.group %}
                {{ student.group.name }}
              {% else %}
                –ë–µ–∑ –≥—Ä—É–ø–ø—ã
              {% endif %}
            </div>
            <div>–ë–∞–ª–∞–Ω—Å: {{ student.contract.balance|default:'0' }}</div>
            <div>–ê–∫—Ç–∏–≤–Ω—ã–π: {{ student.name|yesno }}</div>
            <div>–î–∞—Ç–∞: {{ student.join_date|date:'Y.m.d' }}</div>

            <!-- ================= –õ–ê–ô–ö –∏ –ö–û–†–ó–ò–ù–ê ================= -->
            {% if user.is_authenticated %}
              <form method="post" action="{% url 'like_student' student_id=student.id %}">
                {% csrf_token %}
                <button type="submit" class="like-btn">
                  ‚ù§Ô∏è{% if student.id in liked_students %}
                    –£–±—Ä–∞—Ç—å –ª–∞–π–∫
                  {% else %}
                    –õ–∞–π–∫
                  {% endif %}
                </button>
              </form>

              <form method="post" action="{% url 'add_to_cart' student_id=student.id %}">
                {% csrf_token %}
                <button type="submit" class="cart-btn">üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
              </form>
            {% else %}
              <p>
                <em>–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ª–∞–π–∫–Ω—É—Ç—å –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É.</em>
              </p>
            {% endif %}
          </div>
        {% empty %}
          <p>–ù–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>
        {% endfor %}
      </section>

      <!-- Sidebar —Å–ø—Ä–∞–≤–∞ -->
      <aside class="sidebar" style="width:250px; flex-shrink:0;">
        <div class="auth-bar">
          {% if user.is_authenticated %}
            <span>–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {{ user.username }}!</span>
            <a href="{% url 'student_list' %}">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
            <a href="{% url 'logout_acc' %}">–í—ã–π—Ç–∏</a>
          {% else %}
            <a href="{% url 'login_acc' %}">–í–æ–π—Ç–∏</a>
          {% endif %}
        </div>

        <div class="filter-aside">
          <h3>–§–∏–ª—å—Ç—Ä —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h3>
          <form method="GET">
            {{ filter.form.as_div }}
            <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä</button>
          </form>
        </div>
      </aside>
    </div>

    {% if is_paginated %}
      <div class="pagination">
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
        {% else %}
          <span>–ü—Ä–µ–¥—ã–¥—É—â–∞—è</span>
        {% endif %}

        {% for i in paginator.page_range %}
          {% if page_obj.number == i %}
            <span>{{ i }}</span>
          {% else %}
            <a href="?page={{ i }}">{{ i }}</a>
          {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}">–°–ª–µ–¥—É—é—â–∞—è</a>
        {% else %}
          <span>–°–ª–µ–¥—É—é—â–∞—è</span>
        {% endif %}
      </div>
    {% endif %}
  </main>
{% endblock %}
